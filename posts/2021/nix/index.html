
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Nix language &#8212; Dan&#39;s Blog  documentation</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/blank.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../../../about/" />
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" /> 
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
     
<link
  rel="alternate"
  type="application/atom+xml"
  href="../../../blog/atom.xml"
  title="Dan's Blog"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../../../">
<p class="title">Dan's Blog</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../about/">
  About Dan Poirier
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/poirier" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../../search/" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this site" aria-label="Search this site" autocomplete="off" >
</form>  
<h2>
   
  Nov 17, 2021 
</h2>

<ul>
  
<li id="published">
  <span
    >Update:</span
  >
  Nov 20, 2021
</li>
 
<li id="author">
  <span
    >Author:</span
  >
   
  <a href="../../../blog/author/dan-poirier/">Dan Poirier</a>  
</li>
  
<li id="language">
  <span
    >Language:</span
  >
   
  <a href="../../../blog/language/en/">en</a>  
</li>
 
<li id="category">
  <span
    >Category:</span
  >
   
  <a href="../../../blog/category/os/">os</a>  
</li>
 
<li id="tags">
  <span
    >Tags: </span
  >
   
  <a href="../../../blog/tag/nix/">nix</a>   
  <a href="../../../blog/tag/os/">os</a>   
  <a href="../../../blog/tag/system_management/">system_management</a>   
  <a href="../../../blog/tag/programming/">programming</a>  
</li>
 
</ul>

<h3>
  <a href="../../../blog/">Recent Posts</a>
</h3>
<ul>
   
</ul>

<h3><a href="../../../blog/tag/">Tags</a></h3>
<style type="text/css">
  ul.ablog-cloud {
    list-style: none;
    overflow: auto;
  }
  ul.ablog-cloud li {
    float: left;
    height: 20pt;
    line-height: 18pt;
    margin-right: 5px;
  }
  ul.ablog-cloud a {
    text-decoration: none;
    vertical-align: middle;
  }
  li.ablog-cloud-1 {
    font-size: 80%;
  }
  li.ablog-cloud-2 {
    font-size: 95%;
  }
  li.ablog-cloud-3 {
    font-size: 110%;
  }
  li.ablog-cloud-4 {
    font-size: 125%;
  }
  li.ablog-cloud-5 {
    font-size: 140%;
  }
</style>
<ul class="ablog-cloud">
   
  <li class="ablog-cloud ablog-cloud-3">
    <a href="../../../blog/tag/nix/">nix</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-3">
    <a href="../../../blog/tag/os/">os</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-3">
    <a href="../../../blog/tag/programming/">programming</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-3">
    <a href="../../../blog/tag/system_management/">system_management</a>
  </li>
   
</ul>

<h3>
  <a href="../../../blog/category/">Categories</a>
</h3>
<ul>
   
  <li>
    <a href="../../../blog/category/os/">os (1)</a>
  </li>
   
</ul>

<h3>
  <a href="../../../blog/archive/">Archives</a>
</h3>
<ul>
   
  <li>
    <a href="../../../blog/2021/">2021 (1)</a>
  </li>
   
</ul>

<h3><a href="../../../blog/author/">Authors</a></h3>
<ul>
   
  <li>
    <a href="../../../blog/author/dan-poirier/">Dan Poirier (1)</a>
  </li>
   
</ul>

            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#expressions">
   Expressions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-nix-repl">
   The nix repl
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#immutable">
   Immutable
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#types">
   Types
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identifiers">
   Identifiers
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#attribute-sets">
   Attribute sets
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#if-expressions">
   If expressions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#let-expressions">
   Let expressions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#with-expressions">
   With expressions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#strings">
   Strings
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#paths">
   Paths
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lists">
   Lists
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#functions">
   Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#destructuring">
   Destructuring
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import">
   Import
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#derivations-and-drv-files">
   Derivations and .drv files
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                 <section id="nix-language">
<h1>Nix language<a class="headerlink" href="#nix-language" title="Permalink to this headline">¶</a></h1>
<p>The Nix expression language is used all over in Nix and the Nix OS.</p>
<p><a class="reference external" href="https://nixos.wiki/wiki/Nix_Expression_Language">https://nixos.wiki/wiki/Nix_Expression_Language</a></p>
<div class="note update admonition">
<p class="admonition-title">Updated on Nov 20, 2021</p>
<p>Testing how updates work.</p>
<p>Two paragraphs.</p>
</div>
<section id="expressions">
<h2>Expressions<a class="headerlink" href="#expressions" title="Permalink to this headline">¶</a></h2>
<p>In Nix, <em>everything</em> is an expression. There are no statements.</p>
</section>
<section id="the-nix-repl">
<h2>The nix repl<a class="headerlink" href="#the-nix-repl" title="Permalink to this headline">¶</a></h2>
<p>You can experiment with the Nix language using the <code class="docutils literal notranslate"><span class="pre">nix</span> <span class="pre">repl</span></code>,
e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ nix repl
nix-repl&gt; _
</pre></div>
</div>
</section>
<section id="immutable">
<h2>Immutable<a class="headerlink" href="#immutable" title="Permalink to this headline">¶</a></h2>
<p>In Nix, all values are immutable.</p>
</section>
<section id="types">
<h2>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h2>
<p>While Nix is not statically typed, it is strongly typed. To do
an operation between values of different types, for example,
you have to explicitly convert one value to the other type.</p>
</section>
<section id="identifiers">
<h2>Identifiers<a class="headerlink" href="#identifiers" title="Permalink to this headline">¶</a></h2>
<p>Unlike most other languages, identifiers in Nix can include
the “-” character.  (If you want to subtract, add in some
whitespace to make things unambiguous.)</p>
</section>
<section id="attribute-sets">
<h2>Attribute sets<a class="headerlink" href="#attribute-sets" title="Permalink to this headline">¶</a></h2>
<p><em>Confusingly</em> Nix has a data type formally called attribute sets,
but usually just called <em>sets</em>, that are similar to
Python dictionaries or JavaScript objects: a collection of named values,
called “attributes”.</p>
<p>Literal sets are written as a sequence of assignments,  each one
terminated by a semicolon, all wrapped in curly braces.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">.key</span></code> to access a value from the set, similar to using [key] in Python.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var1</span> <span class="o">=</span> <span class="p">{</span> <span class="n">key1</span><span class="o">=</span><span class="s2">&quot;value1&quot;</span><span class="p">;</span>  <span class="n">key2</span><span class="o">=</span><span class="s2">&quot;value2&quot;</span><span class="p">;</span> <span class="p">}</span>
<span class="n">var1</span><span class="o">.</span><span class="n">key2</span>
<span class="o">&gt;</span> <span class="s2">&quot;value2&quot;</span>
</pre></div>
</div>
<p>You can access an attribute and provide a default in case the set doesn’t
have that attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">a</span> <span class="ow">or</span> <span class="mi">13</span>
</pre></div>
</div>
<p>If you need to refer to another element in the set while writing
the set, you can use <em>recursive</em> sets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val2</span> <span class="o">=</span> <span class="n">rec</span> <span class="p">{</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span> <span class="n">c</span><span class="o">=</span><span class="n">a</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span> <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="if-expressions">
<h2>If expressions<a class="headerlink" href="#if-expressions" title="Permalink to this headline">¶</a></h2>
<p>The expression <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">A</span> <span class="pre">then</span> <span class="pre">val1</span> <span class="pre">else</span> <span class="pre">val2</span></code> has the value val1
if A is true and otherwise val2. Since all expressions must have
a value, if expressions must always have an else.</p>
</section>
<section id="let-expressions">
<h2>Let expressions<a class="headerlink" href="#let-expressions" title="Permalink to this headline">¶</a></h2>
<p>Like lisp, you can use let to temporarily define local variables
for use inside an expression:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="ow">in</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="o">&gt;</span> <span class="mi">7</span>
</pre></div>
</div>
<p>You can refer to variables in the let expression when assigning
variables, like with recursive attribute sets, or <code class="docutils literal notranslate"><span class="pre">let*</span></code> in
Lisp.</p>
</section>
<section id="with-expressions">
<h2>With expressions<a class="headerlink" href="#with-expressions" title="Permalink to this headline">¶</a></h2>
<p>This is just a syntactic shortcut:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nix</span><span class="o">-</span><span class="n">repl</span><span class="o">&gt;</span> <span class="n">longName</span> <span class="o">=</span> <span class="p">{</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="p">}</span>
<span class="n">nix</span><span class="o">-</span><span class="n">repl</span><span class="o">&gt;</span> <span class="n">longName</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">longName</span><span class="o">.</span><span class="n">b</span>
<span class="mi">7</span>
<span class="n">nix</span><span class="o">-</span><span class="n">repl</span><span class="o">&gt;</span> <span class="k">with</span> <span class="n">longName</span><span class="p">;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="mi">7</span>
</pre></div>
</div>
<p>Warning: if there’s already a variable with the same name as
the attribute set used in the <code class="docutils literal notranslate"><span class="pre">with</span></code>, the outer variable is
<strong>not</strong> shadowed and continues to refer to that outer variable.</p>
<p>It seems safer to me to write something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">l</span><span class="o">=</span><span class="n">LongName</span><span class="p">;</span> <span class="ow">in</span> <span class="n">l</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">l</span><span class="o">.</span><span class="n">b</span>
</pre></div>
</div>
</section>
<section id="strings">
<h2>Strings<a class="headerlink" href="#strings" title="Permalink to this headline">¶</a></h2>
<p>Literal strings are written either with double quotes, or two single quotes
at each end:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val1</span> <span class="o">=</span> <span class="s2">&quot;Hello, world.&quot;</span>
<span class="n">val2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="n">And</span> <span class="n">hello</span> <span class="n">to</span> <span class="n">you</span><span class="o">.</span><span class="s1">&#39;&#39;</span>
</pre></div>
</div>
<p>You can use one kind of quotes inside a string written using
the other kind.</p>
<p>In strings, you can interpolate string values using ${}:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val3</span> <span class="o">=</span> <span class="s2">&quot;Hello, $</span><span class="si">{username}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Escaping ${…} within double quoted strings is done with the
backslash. Within two single quotes, it’s done with ‘’ (!):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>nix-repl&gt; &quot;\${foo}&quot;
&quot;${foo}&quot;
nix-repl&gt; &#39;&#39;test &#39;&#39;${foo} test&#39;&#39;
&quot;test ${foo} test&quot;
</pre></div>
</div>
</section>
<section id="paths">
<h2>Paths<a class="headerlink" href="#paths" title="Permalink to this headline">¶</a></h2>
<p>Nix has a special type for file names and paths, called <em>paths</em>. You
don’t need to put quotes around them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="o">/</span><span class="n">foo</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>but note that paths are automatically resolved to absolute paths, so after
the above, the actual path stored in <cite>filename</cite> might be <code class="docutils literal notranslate"><span class="pre">/var/www/a/b/foo.txt</span></code>.</p>
<p>You can also write literally <code class="docutils literal notranslate"><span class="pre">&lt;nixpkgs/stuff&gt;</span></code> and it’ll resolve to the <code class="docutils literal notranslate"><span class="pre">stuff</span></code> directory
under your <code class="docutils literal notranslate"><span class="pre">NIX_PATH</span></code>.</p>
<p>If you have a string like <code class="docutils literal notranslate"><span class="pre">&quot;/foo/bar&quot;</span></code> that you want to use as a path, you
have to convert it by writing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mypath</span> <span class="o">=</span> <span class="o">/.</span> <span class="o">+</span> <span class="n">builtins</span><span class="o">.</span><span class="n">toPath</span> <span class="s2">&quot;/foo/bar&quot;</span>
</pre></div>
</div>
<p>(<a class="reference external" href="https://nixos.wiki/wiki/Nix_Expression_Language#Convert_a_string_to_an_.28import-able.29_path">https://nixos.wiki/wiki/Nix_Expression_Language#Convert_a_string_to_an_.28import-able.29_path</a>)</p>
</section>
<section id="lists">
<h2>Lists<a class="headerlink" href="#lists" title="Permalink to this headline">¶</a></h2>
<p>Lists are written as a series of expressions separated by space (NOT COMMA)
and with square brackets around them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="mi">2</span> <span class="s2">&quot;foo&quot;</span> <span class="n">true</span> <span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="p">]</span>
</pre></div>
</div>
<p>Lists are immutable, so adding or removing elements returns a new list.</p>
</section>
<section id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<p>Functions are all unnamed lambda functions, sometimes assigned to variables, and all have a single argument.
They have the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">argument</span><span class="p">:</span> <span class="n">nixExpression</span>
</pre></div>
</div>
<p>so for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">funca</span> <span class="o">=</span> <span class="n">argument</span><span class="p">:</span> <span class="n">argument</span> <span class="o">*</span> <span class="n">argument</span>
</pre></div>
</div>
<p>Call a function by writing the name of the function (well, the
name of the variable the function was assigned to), a space,
then the expression to pass as the functions argument. No
parentheses or commas.</p>
<p>e.g. <code class="docutils literal notranslate"><span class="pre">funca</span> <span class="pre">12</span></code> would square its input and have the value <code class="docutils literal notranslate"><span class="pre">144</span></code>.</p>
<p>For multiple arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">funcb</span> <span class="o">=</span> <span class="n">arg1</span><span class="p">:</span> <span class="n">arg2</span><span class="p">:</span> <span class="n">nixExpression</span>
<span class="n">funcb</span> <span class="mi">1</span> <span class="mi">34</span>
</pre></div>
</div>
<p>You can create partials:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">funcc</span> <span class="o">=</span> <span class="n">funcb</span> <span class="mi">1</span>
</pre></div>
</div>
<p>would be a new function that takes one argument and returns the value of <code class="docutils literal notranslate"><span class="pre">funcb</span> <span class="pre">1</span> <span class="pre">&lt;new</span> <span class="pre">argument&gt;</span></code>.</p>
</section>
<section id="destructuring">
<h2>Destructuring<a class="headerlink" href="#destructuring" title="Permalink to this headline">¶</a></h2>
<p>You can pass a set into a function and declare the keys the set should have:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">funcd</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">}:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="n">funcd</span> <span class="p">{</span><span class="n">a</span><span class="o">=</span><span class="mi">12</span><span class="p">;</span> <span class="n">b</span><span class="o">=</span><span class="mi">13</span><span class="p">;}</span>
<span class="o">&gt;</span> <span class="mi">25</span>
</pre></div>
</div>
<p>You can declare default values for some or all the keys:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>add_a_b = { a ? 1, b ? 2 }: a + b
add_a_b {}
3
add_a_b {a=5;}
7
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This looks like Python named arguments - cool!</p>
</div>
<p>If the set passed in the call has additional keys, the call will fail unless you say to allow that
by adding <code class="docutils literal notranslate"><span class="pre">...</span></code>.  You can access any extra keys by supplying a name with <code class="docutils literal notranslate"><span class="pre">&#64;</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">add_a_b</span> <span class="o">=</span> <span class="n">args</span><span class="o">@</span><span class="p">{</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">...</span> <span class="p">}:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">c</span>
<span class="n">add_a_b</span> <span class="p">{</span> <span class="n">a</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span> <span class="n">c</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span> <span class="p">}</span>
<span class="mi">17</span>
</pre></div>
</div>
</section>
<section id="import">
<h2>Import<a class="headerlink" href="#import" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">import</span></code> keyword loads a Nix expression from a file, evaluates it, and
returns the result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="kn">import</span> <span class="nn">a</span><span class="o">/</span><span class="n">b</span><span class="o">/</span><span class="n">path</span>
</pre></div>
</div>
<p>If the result is a function, you can of course
call it immediately:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="kn">import</span> <span class="o">&lt;</span><span class="n">nixpkgs</span><span class="o">/</span><span class="n">myfile</span><span class="o">.</span><span class="n">nix</span><span class="o">&gt;</span> <span class="p">{</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">b</span><span class="o">=</span><span class="mi">12</span><span class="p">;}</span>
</pre></div>
</div>
</section>
<section id="derivations-and-drv-files">
<h2>Derivations and .drv files<a class="headerlink" href="#derivations-and-drv-files" title="Permalink to this headline">¶</a></h2>
<p>There’s a built-in function named <code class="docutils literal notranslate"><span class="pre">derivation</span></code>. It takes
an argument set with at least three elements:</p>
<ul class="simple">
<li><p>name: a name for the derivation</p></li>
<li><p>system: is the name of the system in which the derivation can be built. For example, x86_64-linux.</p></li>
<li><p>builder: it is the binary program that builds the derivation.</p></li>
</ul>
<p>Aside: the currently running system is available
as <code class="docutils literal notranslate"><span class="pre">builtins.currentSystem</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">builtins</span><span class="o">.</span><span class="n">currentSystem</span>
<span class="o">&gt;</span> <span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span>
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">nix</span> <span class="pre">repl</span></code>, calling derivation with a derivation expression
will not build the derivation (e.g. compile the package), but
it will create the <code class="docutils literal notranslate"><span class="pre">.drv</span></code> file.</p>
<p>(The <code class="docutils literal notranslate"><span class="pre">.drv</span></code> file is kind of like a compiled .c file - it’s
a more compact representation of the derivation, but it doesn’t
do anything by itself.)</p>
<p>In the nix repl, the value returned by calling <code class="docutils literal notranslate"><span class="pre">derivation</span></code>
is an attribute set.  It will be printed something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>nix-repl&gt; d = derivation { name = &quot;myname&quot;; builder = &quot;mybuilder&quot;; system = &quot;mysystem&quot;; }
nix-repl&gt; d
«derivation /nix/store/z3hhlxbckx4g3n9sw91nnvlkjvyw754p-myname.drv»
</pre></div>
</div>
<p>because Nix does something special if an attribute set has
an attribute named “type”, and this one has <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">&quot;derivation&quot;</span></code>,
but it’s really just an attribute set.</p>
<p>We can refer elsewhere to a derivation by its outPath string, which
we can easily extract using <code class="docutils literal notranslate"><span class="pre">builtins.toString</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nix</span><span class="o">-</span><span class="n">repl</span><span class="o">&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">toString</span> <span class="n">d</span>
<span class="s2">&quot;/nix/store/40s0qmrfb45vlh6610rk29ym318dswdr-myname&quot;</span>
</pre></div>
</div>
<p>(builtins.toString just returns the <code class="docutils literal notranslate"><span class="pre">outPath</span></code> attribute after
converting it to a string.)</p>
<p>You can pretty-print the .drv file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ nix show-derivation /nix/store/z3hhlxbckx4g3n9sw91nnvlkjvyw754p-myname.drv
{
  &quot;/nix/store/z3hhlxbckx4g3n9sw91nnvlkjvyw754p-myname.drv&quot;: {
    &quot;outputs&quot;: {
      &quot;out&quot;: {
        &quot;path&quot;: &quot;/nix/store/40s0qmrfb45vlh6610rk29ym318dswdr-myname&quot;
      }
    },
    &quot;inputSrcs&quot;: [],
    &quot;inputDrvs&quot;: {},
    &quot;platform&quot;: &quot;mysystem&quot;,
    &quot;builder&quot;: &quot;mybuilder&quot;,
    &quot;args&quot;: [],
    &quot;env&quot;: {
      &quot;builder&quot;: &quot;mybuilder&quot;,
      &quot;name&quot;: &quot;myname&quot;,
      &quot;out&quot;: &quot;/nix/store/40s0qmrfb45vlh6610rk29ym318dswdr-myname&quot;,
      &quot;system&quot;: &quot;mysystem&quot;
    }
  }
}
</pre></div>
</div>
<p>There’s an “out” path that tells us <em>where</em> Nix would put
the build output if we were to build it.</p>
<p>If you really want to build a derivation in <code class="docutils literal notranslate"><span class="pre">nix</span> <span class="pre">repl</span></code>,
use the nix repl command <code class="docutils literal notranslate"><span class="pre">:b</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>nix-repl&gt; d = derivation { name = &quot;myname&quot;; builder = &quot;mybuilder&quot;; system = &quot;mysystem&quot;; }
nix-repl&gt; :b d
[...]
these derivations will be built:
  /nix/store/z3hhlxbckx4g3n9sw91nnvlkjvyw754p-myname.drv
building path(s) `/nix/store/40s0qmrfb45vlh6610rk29ym318dswdr-myname&#39;
error: a `mysystem&#39; is required to build `/nix/store/z3hhlxbckx4g3n9sw91nnvlkjvyw754p-myname.drv&#39;, but I am a `x86_64-linux&#39;
</pre></div>
</div>
<p>Outside <code class="docutils literal notranslate"><span class="pre">nix</span> <span class="pre">repl</span></code>, you can “realize” (build) a derivation with <code class="docutils literal notranslate"><span class="pre">nix-store</span> <span class="pre">-r</span></code>, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ nix-store -r /nix/store/z3hhlxbckx4g3n9sw91nnvlkjvyw754p-myname.drv
</pre></div>
</div>
</section>
</section>

<div class="section">
     
<div class="section">
  <span style="float: left">
    
  </span>
  <span>&nbsp;</span>
  <span style="float: right">
    
  </span>
</div>
  
</div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, Dan Poirier.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>